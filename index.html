<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boutique simple — 10 produits</title>
  <style>
    :root{--accent:#0ea5a4;--muted:#6b7280;--card:#ffffff;--bg:#f3f4f6}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:var(--bg);color:#111}
    header{background:linear-gradient(90deg,#06b6d4, #0891b2);color:#fff;padding:18px 20px;display:flex;align-items:center;justify-content:space-between}
    header h1{font-size:18px;margin:0}
    .container{max-width:1100px;margin:28px auto;padding:0 20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);display:flex;flex-direction:column}
    .thumb{height:160px;border-radius:8px;background:#e5e7eb;display:block;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .title{font-weight:600;margin:10px 0 6px}
    .price{color:var(--accent);font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .actions{margin-top:auto;display:flex;gap:8px}
    button{background:var(--accent);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.secondary{background:#fff;color:var(--accent);border:1px solid rgba(15,23,42,0.06)}
    .cart{position:fixed;right:18px;bottom:18px;width:340px;background:#fff;border-radius:12px;box-shadow:0 12px 30px rgba(2,6,23,0.2);overflow:hidden}
    .cart header{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid #eef2f7}
    .cart .body{max-height:320px;overflow:auto;padding:12px}
    .cart .footer{padding:12px;border-top:1px solid #eef2f7}
    .cart-item{display:flex;gap:8px;margin-bottom:10px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .cart-item .meta{flex:1}
    .qty{display:flex;gap:6px;align-items:center}
    .small{font-size:13px}
    .empty{padding:28px;text-align:center;color:var(--muted)}
    @media(max-width:720px){.cart{position:static;width:auto;margin:18px}} 
  </style>
</head>
<body>
  <header>
    <h1>Ma Boutique — 10 produits</h1>
    <div class="small">Paiement rapide via PayPal (sandbox pour test)</div>
  </header>

  <main class="container">
    <section>
      <h2 style="margin:0 0 12px">Produits</h2>
      <div class="grid" id="products"></div>
    </section>
  </main>

  <!-- Cart -->
  <aside class="cart" id="cart">
    <header>
      <strong>Panier</strong>
      <button id="clearCart" class="secondary">Vider</button>
    </header>
    <div class="body" id="cartBody"></div>
    <div class="footer">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="small">Total</div>
        <div><strong id="cartTotal">0.00 €</strong></div>
      </div>
      <div id="paypal-button-container"></div>
    </div>
  </aside>

  <script>
    // --- Données produits (10 produits d'exemple) ---
    const PRODUCTS = [
      {id:1,name:'Maillot PSG 4',price:25,img:'https://picsum.photos/seed/p1/600/400',desc:'T-shirt doux, coupe classique.'},
      {id:2,name:'Maillot Palestine',price:25,img:'https://picsum.photos/seed/p2/600/400',desc:'Casquette réglable.'},
      {id:3,name:'T-shirt PNL',price:50,img:'https://picsum.photos/seed/p3/600/400',desc:'Chaud et confortable.'},
      {id:4,name:'Manette PS5 noire',price:9.90,img:'https://picsum.photos/seed/p4/600/400',desc:'Pratique et solide.'},
      {id:5,name:'Manette PS5 blanche',price:49.00,img:'https://picsum.photos/seed/p5/600/400',desc:'Légère pour l'extérieur.'},
    ];

    // --- Rendu des produits ---
    const productsEl = document.getElementById('products');
    PRODUCTS.forEach(p => {
      const card = document.createElement('article');
      card.className='card';
      card.innerHTML = `
        <a class="thumb" href="#" onclick="return false;"><img src="${p.img}" alt="${p.name}"></a>
        <div class="title">${p.name}</div>
        <div class="muted small">${p.desc}</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div class="price">${p.price.toFixed(2)} €</div>
          <div class="actions">
            <button onclick='addToCart(${p.id})'>Ajouter</button>
          </div>
        </div>
      `;
      productsEl.appendChild(card);
    });

    // --- Panier simple stocké en localStorage ---
    const CART_KEY = 'simple_shop_cart_v1';
    let cart = JSON.parse(localStorage.getItem(CART_KEY) || '{}');

    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCart(); }

    function addToCart(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      if(cart[id]) cart[id].qty += 1; else cart[id] = {id:p.id,name:p.name,price:p.price,img:p.img,qty:1};
      saveCart();
    }

    function removeFromCart(id){ if(!cart[id]) return; delete cart[id]; saveCart(); }
    function changeQty(id,delta){ if(!cart[id]) return; cart[id].qty = Math.max(1, cart[id].qty + delta); saveCart(); }
    function clearCart(){ cart={}; saveCart(); }

    document.getElementById('clearCart').addEventListener('click', ()=>{ if(confirm('Vider le panier ?')) clearCart(); });

    function cartTotal(){
      return Object.values(cart).reduce((s,i)=>s + i.price * i.qty, 0);
    }

    function renderCart(){
      const body = document.getElementById('cartBody');
      body.innerHTML='';
      const items = Object.values(cart);
      if(items.length===0){ body.innerHTML = '<div class="empty">Ton panier est vide</div>'; document.getElementById('cartTotal').textContent = '0.00 €'; return; }
      items.forEach(it=>{
        const el = document.createElement('div'); el.className='cart-item';
        el.innerHTML = `
          <img src="${it.img}" alt="${it.name}">
          <div class="meta">
            <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${it.name}</strong></div><div class="price">${(it.price*it.qty).toFixed(2)} €</div></div>
            <div class="small">${it.price.toFixed(2)} € x ${it.qty}</div>
            <div class="qty" style="margin-top:8px">
              <button onclick="changeQty(${it.id},-1)">-</button>
              <div style="min-width:22px;text-align:center">${it.qty}</div>
              <button onclick="changeQty(${it.id},1)">+</button>
              <button class="secondary" style="margin-left:8px" onclick="removeFromCart(${it.id})">Suppr</button>
            </div>
          </div>
        `;
        body.appendChild(el);
      });
      document.getElementById('cartTotal').textContent = cartTotal().toFixed(2) + ' €';
    }

    // --- Initial render ---
    renderCart();

    // --- Intégration PayPal (client-side sandbox) ---
    // IMPORTANT : remplacer client-id 'sb' par ton client-id live PayPal pour les paiements réels
  </script>

  <!-- PayPal SDK : 'sb' est le client-id sandbox pour tests. Remplacez par votre client-id live pour production. -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=EUR" data-sdk-integration-source="button-factory"></script>
  <script>
    // Fonction utilitaire pour créer un objet purchase_unit depuis le panier
    function buildPurchaseUnit(){
      const items = Object.values(cart).map(it => ({ name: it.name, unit_amount: { currency_code: 'EUR', value: it.price.toFixed(2) }, quantity: String(it.qty) }));
      const total = cartTotal().toFixed(2);
      return [{ amount: { currency_code: 'EUR', value: total, breakdown: { item_total: { currency_code:'EUR', value: total } } }, items }];
    }

    // Rendu des boutons PayPal
    paypal.Buttons({
      style: {layout:'vertical', color:'gold', shape:'rect', label:'paypal'},
      onInit: function(data, actions){
        // désactiver le bouton si panier vide
        if(cartTotal() === 0){ actions.disable(); }
        // réagir aux changements de panier
        window.addEventListener('storage', ()=>{ if(cartTotal()===0) actions.disable(); else actions.enable(); });
      },
      createOrder: function(data, actions){
        const total = cartTotal().toFixed(2);
        if(total === '0.00') return alert('Ton panier est vide');
        return actions.order.create({
          purchase_units: buildPurchaseUnit()
        });
      },
      onApprove: function(data, actions){
        return actions.order.capture().then(function(details){
          // paiement réussi
          alert('Paiement confirmé — Merci, ' + (details.payer.name.given_name || '') + '!');
          // ici tu peux sauvegarder la commande sur ton serveur ou envoyer un email
          clearCart();
        });
      },
      onError: function(err){
        console.error(err); alert('Erreur paiement : ' + err);
      }
    }).render('#paypal-button-container');

    // S'assurer que le bouton se met à jour quand le panier change (local)
    const origSaveCart = saveCart;
    saveCart = function(){ origSaveCart(); // re-render PayPal button state by reloading the SDK tiny bit: enable/disable handled via storage event
      window.dispatchEvent(new Event('storage'));
    }
  </script>

</body>
</html>
